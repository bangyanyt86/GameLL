import React, { useState } from 'react';
import { Star, RefreshCw, Trophy, PlayCircle } from 'lucide-react';

const App = () => {
  const [gameState, setGameState] = useState('start'); // 'start', 'play', 'feedback'
  const [targetCount, setTargetCount] = useState(0);
  const [options, setOptions] = useState([]);
  const [score, setScore] = useState(0);
  const [isCorrect, setIsCorrect] = useState(null);
  const [currentFruit, setCurrentFruit] = useState('üçé');

  const fruits = ['üçé', 'üçå', 'üçä', 'üçì', 'üçá', 'üçç', 'üçâ', 'üçê'];

  // Generate a new level with a random fruit and count
  const generateLevel = () => {
    const count = Math.floor(Math.random() * 5) + 1; // Numbers 1 to 5 for simplicity
    const fruit = fruits[Math.floor(Math.random() * fruits.length)];

    let opts = new Set([count]);
    while (opts.size < 4) {
      opts.add(Math.floor(Math.random() * 5) + 1);
    }

    setTargetCount(count);
    setCurrentFruit(fruit);
    setOptions(Array.from(opts).sort((a, b) => a - b));
    setIsCorrect(null);
    setGameState('play');
  };

  const handleAnswer = (num) => {
    if (num === targetCount) {
      setIsCorrect(true);
      setScore(s => s + 1);
    } else {
      setIsCorrect(false);
    }
    setGameState('feedback');
  };

  const resetGame = () => {
    setScore(0);
    generateLevel();
  };

  // Start Screen UI
  if (gameState === 'start') {
    return (
      <div className="min-h-screen bg-orange-50 flex flex-col items-center justify-center p-6 text-center">
        <div className="bg-white p-10 rounded-[3rem] shadow-2xl border-b-8 border-orange-200">
          <div className="text-8xl mb-6 animate-bounce">üçé</div>
          <h1 className="text-4xl font-black text-orange-600 mb-2">Let‚Äôs Count!</h1>
          <p className="text-gray-500 font-medium mb-8">Fun Fruit Quiz for Kids</p>
          <button
            onClick={generateLevel}
            className="bg-green-500 hover:bg-green-600 text-white text-2xl font-black px-12 py-5 rounded-3xl shadow-lg transform active:scale-95 transition-all flex items-center gap-3"
          >
            <PlayCircle size={32} /> START
          </button>
        </div>
      </div>
    );
  }

  // Main Quiz UI
  return (
    <div className="min-h-screen bg-sky-50 flex flex-col items-center p-6">
      {/* Score Header */}
      <div className="w-full max-w-md flex justify-between items-center mb-10">
        <div className="bg-white px-6 py-2 rounded-full shadow-md border-2 border-sky-200 flex items-center gap-2">
          <Trophy className="text-yellow-500" />
          <span className="font-black text-xl text-gray-700">{score}</span>
        </div>
        <button 
          onClick={resetGame} 
          className="p-2 bg-white rounded-full shadow-md text-gray-400 hover:text-sky-500 transition-colors"
        >
          <RefreshCw size={24} />
        </button>
      </div>

      <div className="bg-white w-full max-w-md rounded-[3rem] shadow-xl overflow-hidden p-8 border-b-8 border-gray-100">
        {/* Fruit Display Area */}
        <div className="bg-yellow-50 rounded-3xl p-8 mb-8 flex flex-wrap justify-center items-center gap-4 min-h-[150px]">
          {Array.from({ length: targetCount }).map((_, i) => (
            <span
              key={i}
              className="text-6xl animate-in zoom-in duration-300"
              style={{ animationDelay: `${i * 100}ms` }}
            >
              {currentFruit}
            </span>
          ))}
        </div>

        {gameState === 'play' ? (
          <>
            <h2 className="text-2xl font-black text-gray-800 mb-6 text-center">
              How many fruits are there?
            </h2>
            <div className="grid grid-cols-2 gap-4">
              {options.map(num => (
                <button
                  key={num}
                  onClick={() => handleAnswer(num)}
                  className="bg-white border-4 border-sky-100 hover:border-sky-400 text-4xl font-black py-6 rounded-3xl text-sky-600 transition-all active:scale-90 shadow-sm"
                >
                  {num}
                </button>
              ))}
            </div>
          </>
        ) : (
          <div className="text-center animate-in fade-in zoom-in">
            {isCorrect ? (
              <div className="py-4">
                <div className="flex justify-center gap-2 mb-4">
                  {[...Array(3)].map((_, i) => (
                    <Star
                      key={i}
                      className="text-yellow-400 fill-yellow-400 animate-bounce"
                      size={40}
                    />
                  ))}
                </div>
                <h2 className="text-4xl font-black text-green-500 mb-6">
                  GREAT JOB! ü•≥
                </h2>
              </div>
            ) : (
              <div className="py-4">
                <h2 className="text-4xl font-black text-red-400 mb-2">
                  OOPS! üßê
                </h2>
                <p className="text-xl font-bold text-gray-500 mb-6">
                  The correct answer is {targetCount}
                </p>
              </div>
            )}

            <button
              onClick={generateLevel}
              className="w-full bg-orange-500 hover:bg-orange-600 text-white font-black py-5 rounded-2xl text-2xl shadow-lg transition-all active:scale-95"
            >
              NEXT QUESTION
            </button>
          </div>
        )}
      </div>

      <p className="mt-8 text-sky-300 font-bold tracking-widest uppercase text-sm">
        Counting Fruits Quiz
      </p>
    </div>
  );
};

export default App;
